import{a as I}from"./accountInput-DqXUacMV.js";import{a as _}from"./index-B8KhkOGp.js";import{b as $}from"./bannerComponent-BTsLBmZ_.js";import{i as k}from"./inputPlus-CAlsS9yD.js";import{r as l,o as L,u as D,c as A,a as r,b as g,w as E,d as G,t as p,e as f,f as N,s as R,g as H}from"./index-BDoxEieh.js";import{_ as q}from"./_plugin-vue_export-helper-DlAUqK2U.js";import"./help-CmPQ-lNE.js";const M={class:"forgetPassword"},O={id:"loginBtn",class:"login"},j={class:"toRegist"},F={__name:"login",setup(J){const V=N(),h=D(),n=l(""),m=l(""),s=l(""),w=l(""),v=l(!0),u=l(!0),t=l(!1),c=l(!1);let i=null;const y=()=>{n.value=="email"&&(n.value="")},b=e=>{n.value=e,console.log("账号类型已更新:",n.value)},C=e=>{v.value=e,t.value=!1,console.log("isAccountValid",v.value,"accountError",t.value)},T=e=>{console.log("passwordHandleValidChange",e),u.value=e,c.value=!1,console.log("isPasswordValid",u.value,"passwordError",c.value)},S=(e,o)=>{w.value=e,u.value=o,console.log("密码输入:",e,"是否有效:",o)},P=e=>{console.log("handleLoginSuccess",e);const o={captcha_id:"d9b22c2488def2cfa35aa4b6a4cbe74d",captcha_response:e.geetest_validate,challenge:m.value,password:w.value,username:s.value};n.value==="phone"&&(o.national_code=localStorage.getItem("nationalCode")||"86"),console.log("account.value",s.value),console.log("accountType.value",n.value),console.log("loginParams",o),_.userLogin(o).then(a=>{console.log("登录成功:",a),V.push("/")}).catch(a=>{console.error("登录失败:",a),R(a.response.data.msg)})};var B=function(e){console.log("极验handler被调用"),i=e,i.onReady(function(){console.log("极验验证码准备就绪")}).onSuccess(function(){var o=i.getValidate();if(!o)return alert("请完成验证");console.log("验证成功，参数:",o),P(o)}).onError(function(o){console.error("极验验证出错:",o)}),setTimeout(()=>{const o=document.getElementById("loginBtn");o?(console.log("找到登录按钮，添加极验事件"),o.addEventListener("click",function(){console.log("登录按钮被点击");let a=!1;v.value===!1&&(t.value=!0,console.log("accountError",t.value),console.log("账号错误"),a=!0),u.value===!1&&(c.value=!0,console.log("passwordError",c.value),console.log("密码错误"),a=!0),a?console.log("存在格式错误，不进行极验验证"):(i.verify(),console.log("账号密码验证通过，开始极验验证"))})):console.error("未找到登录按钮")},500)};return L(()=>{if(console.log("accountType:",n.value),h.path==="/login"&&h.query.from==="selectCountry"){n.value="phone";const e=sessionStorage.getItem("tempLoginData");if(console.log("savedData",e),e)try{const{account:o,type:a}=JSON.parse(e);n.value=a,s.value=o,sessionStorage.removeItem("tempLoginData"),setTimeout(()=>{const d=document.querySelector(".accountPanel input");d&&d.focus()},300)}catch(o){console.error("解析保存的账号数据失败:",o)}}console.log("组件挂载，初始化极验"),_.register({captcha_id:"d9b22c2488def2cfa35aa4b6a4cbe74d"}).then(e=>{console.log("极验初始化数据获取成功:",e),m.value=e.challenge,window.initGeetest?(console.log("调用initGeetest初始化极验"),window.initGeetest({gt:e.gt,challenge:e.challenge,offline:!e.success,new_captcha:e.new_captcha,product:"bind"},B)):console.error("未找到initGeetest函数")}).catch(e=>{console.error("获取极验初始化数据失败:",e)})}),(e,o)=>{const a=G("router-link");return H(),A("div",{class:"root",onClick:y},[r($,{content:e.$t("登录您的CEEX专属账号")},null,8,["content"]),g("main",null,[r(I,{modelValue:s.value,"onUpdate:modelValue":o[0]||(o[0]=d=>s.value=d),onTypeChange:b,onValidChange:C,from:"/login",accountError:t.value},null,8,["modelValue","accountError"]),r(k,{labelTitle:e.$t("密码"),placeholder:e.$t("密码"),type:"password",onSendValue:S,onValidChange:T,showErrorMessage:!0,passwordError:c.value},null,8,["labelTitle","placeholder","passwordError"]),g("div",M,[r(a,{to:"/forgetPassword"},{default:E(()=>[f(p(e.$t("忘记密码")),1)]),_:1})]),g("button",O,p(e.$t("登录")),1),g("div",j,[f(p(e.$t("还没账号"))+" ? ",1),r(a,{to:"/regist"},{default:E(()=>[f(p(e.$t("注册")),1)]),_:1})])])])}}},Z=q(F,[["__scopeId","data-v-7f675842"]]);export{Z as default};
