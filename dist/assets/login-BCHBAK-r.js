import{_ as B}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{a as I}from"./accountInput-CK1ZVtm5.js";import{a as V}from"./index-DYDmJwWO.js";import{b as $}from"./bannerComponent-D4Az8HOE.js";import{i as L}from"./inputPlus-DLv0Kg01.js";import{r as s,o as A,u as D,c as G,a as u,b as d,w as y,d as N,t as p,e as m,f as F,s as H,g as q}from"./index-DvRa-Evj.js";import{c as O,a as j}from"./validate-2aEoLZUc.js";import"./help-CmPQ-lNE.js";const J={class:"forgetPassword"},U={id:"loginBtn",class:"login"},X={class:"toRegist"},z={__name:"login",setup(K){const b=F(),h=D(),l=s(""),w=s(""),c=s(""),v=s(""),f=s(!0),i=s(!0),n=s(!1),t=s(!1),E=s(""),_=s("");let g=null;const C=()=>{l.value=="email"&&(l.value="")},T=o=>{l.value=o,console.log("账号类型已更新:",l.value)},S=o=>{f.value=o,n.value=!1,console.log("isAccountValid",f.value,"accountError",n.value)},P=o=>{console.log("passwordHandleValidChange",o),i.value=o,t.value=!1,console.log("isPasswordValid",i.value,"passwordError",t.value)},k=(o,e)=>{v.value=o,i.value=e,console.log("密码输入:",o,"是否有效:",e)},M=o=>{console.log("handleLoginSuccess",o);const e={captcha_id:"d9b22c2488def2cfa35aa4b6a4cbe74d",captcha_response:o.geetest_validate,challenge:w.value,password:v.value,username:c.value};l.value==="phone"&&(e.national_code=localStorage.getItem("nationalCode")||"86"),console.log("account.value",c.value),console.log("accountType.value",l.value),console.log("loginParams",e),V.userLogin(e).then(a=>{console.log("登录成功:",a),b.push("/")}).catch(a=>{console.error("登录失败:",a),H(a.response.data.msg)})};var R=function(o){console.log("极验handler被调用"),g=o,g.onReady(function(){console.log("极验验证码准备就绪")}).onSuccess(function(){var e=g.getValidate();if(!e)return alert("请完成验证");console.log("验证成功，参数:",e),M(e)}).onError(function(e){console.error("极验验证出错:",e)}),setTimeout(()=>{const e=document.getElementById("loginBtn");e?(console.log("找到登录按钮，添加极验事件"),e.addEventListener("click",function(){console.log("登录按钮被点击");let a=!1;f.value===!1&&(n.value=!0,console.log("accountError",n.value),console.log("账号错误"),a=!0),O(c.value).isValid||(n.value=!0,console.log("accountError",n.value),console.log("账号错误"),E.value="账号不能包含空格或中文字符",a=!0),i.value===!1&&(t.value=!0,console.log("passwordError",t.value),console.log("密码错误"),a=!0),j(v.value).isValid||(t.value=!0,console.log("passwordError",t.value),console.log("密码错误"),_.value="密码不能包含空格或中文字符",a=!0),a?console.log("存在格式错误，不进行极验验证"):(g.verify(),console.log("账号密码验证通过，开始极验验证"))})):console.error("未找到登录按钮")},500)};return A(()=>{if(console.log("accountType:",l.value),h.path==="/login"&&h.query.from==="selectCountry"){l.value="phone";const o=sessionStorage.getItem("tempLoginData");if(console.log("savedData",o),o)try{const{account:e,type:a}=JSON.parse(o);l.value=a,c.value=e,sessionStorage.removeItem("tempLoginData"),setTimeout(()=>{const r=document.querySelector(".accountPanel input");r&&r.focus()},300)}catch(e){console.error("解析保存的账号数据失败:",e)}}console.log("组件挂载，初始化极验"),V.register({captcha_id:"d9b22c2488def2cfa35aa4b6a4cbe74d"}).then(o=>{console.log("极验初始化数据获取成功:",o),w.value=o.challenge,window.initGeetest?(console.log("调用initGeetest初始化极验"),window.initGeetest({gt:o.gt,challenge:o.challenge,offline:!o.success,new_captcha:o.new_captcha,product:"bind"},R)):console.error("未找到initGeetest函数")}).catch(o=>{console.error("获取极验初始化数据失败:",o)})}),(o,e)=>{const a=N("router-link");return q(),G("div",{class:"root",onClick:C},[u($,{content:o.$t("登录您的CEEX专属账号")},null,8,["content"]),d("main",null,[u(I,{modelValue:c.value,"onUpdate:modelValue":e[0]||(e[0]=r=>c.value=r),onTypeChange:T,onValidChange:S,from:"/login",accountError:n.value,accountErrorMessage:E.value},null,8,["modelValue","accountError","accountErrorMessage"]),u(L,{labelTitle:o.$t("密码"),placeholder:o.$t("密码"),type:"password",onSendValue:k,onValidChange:P,showErrorMessage:!0,passwordError:t.value,errorMessage:_.value},null,8,["labelTitle","placeholder","passwordError","errorMessage"]),d("div",J,[u(a,{to:"/forgetPassword"},{default:y(()=>[m(p(o.$t("忘记密码")),1)]),_:1})]),d("button",U,p(o.$t("登录")),1),d("div",X,[m(p(o.$t("还没账号"))+" ? ",1),u(a,{to:"/regist"},{default:y(()=>[m(p(o.$t("注册")),1)]),_:1})])])])}}},lo=B(z,[["__scopeId","data-v-13abf6d0"]]);export{lo as default};
