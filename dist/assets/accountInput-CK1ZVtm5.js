import{r as c,l as S,o as $,q as i,c as v,g as f,b as p,t as C,f as J,x as M,i as k,h as O,y as G,a as U,p as W,n as H,F as K,z as Q}from"./index-DvRa-Evj.js";import{_ as b}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{g as T,v as X,a as Y}from"./help-CmPQ-lNE.js";const Z=["src","alt"],ee={class:"country-code"},oe={__name:"selectCountry",props:{account:{type:String,default:""},from:String},setup(E,{expose:_}){const I=J(),e=E,o=c({nationalCode:"86",countryName:"中国大陆",shortName:"CN"}),l=()=>{console.log("更新国家选择信息");const a=localStorage.getItem("selectCountry");if(a)try{const n=JSON.parse(a);n&&n.nationalCode&&n.shortName?(console.log("使用存储的国家信息:",n),o.value=n):(console.log("存储的国家信息不完整，使用默认值"),r())}catch(n){console.error("解析存储的国家信息失败:",n),r()}else console.log("没有存储的国家信息，使用默认值"),r();i(()=>{const n=document.querySelector(".country-select .flag");n&&(n.src=`https://d1133sjcnebqrc.cloudfront.net/bhop/image/flag/${o.value.shortName}.png`)})},r=()=>{const a=localStorage.getItem("nationalCode")||"86";console.log("设置默认国家，区号:",a),o.value={nationalCode:a,countryName:"中国大陆",shortName:"CN"}};S(()=>localStorage.getItem("selectCountry"),()=>{console.log("国家选择信息变化，重新更新"),l()},{immediate:!0}),S(()=>localStorage.getItem("nationalCode"),()=>{console.log("国家代码变化，检查是否需要更新默认值"),localStorage.getItem("selectCountry")||r()},{immediate:!0});const y=()=>{if(e.account&&e.account.length>3){const n={account:e.account,type:"phone"};sessionStorage.setItem("tempLoginData",JSON.stringify(n))}let a="/selectCountry";e.from&&(a+=`?from=${e.from}`),console.log("跳转到国家选择页面:",a),I.push(a)};return $(()=>{console.log("国家选择组件已挂载，初始化国家信息"),l(),i(()=>{setTimeout(()=>{const a=document.querySelector(".country-select .flag");a&&(console.log("刷新国旗图标"),a.src=`https://d1133sjcnebqrc.cloudfront.net/bhop/image/flag/${o.value.shortName}.png`)},50)})}),_({updateSelectedCountry:l}),(a,n)=>(f(),v("div",{class:"country-select",onClick:y},[p("img",{class:"flag",src:`https://d1133sjcnebqrc.cloudfront.net/bhop/image/flag/${o.value.shortName}.png`,alt:o.value.countryName},null,8,Z),p("span",ee,"+ "+C(o.value.nationalCode),1)]))}},ae=b(oe,[["__scopeId","data-v-3f533176"]]),le={class:"root"},te={for:""},ne=["placeholder","value"],se={key:0,class:"errorMessage"},ue={key:1,class:"emailTypeList"},re=["onClick"],ce={__name:"accountInput",props:{modelValue:{type:String,default:""},showErrorMessage:{type:Boolean,default:!0},from:{type:String,default:"/login"},accountError:{type:Boolean,default:!1},accountErrorMessage:{type:String,default:""}},emits:["update:modelValue","typeChange","validChange"],setup(E,{expose:_,emit:I}){const e=E,o=I,l=c(""),r=c(!1),y=c(!1),a=c(!0),n=c(!1),u=c(!1),A=c(["@gmail.com","@163.com","@outlook.com"]),L=c(["@gmail.com","@163.com","@outlook.com","@qq.com","@icloud.com","@yahoo.com"]),R=M(()=>{if(!e.modelValue)return[];if(e.modelValue.includes("@")){const s=e.modelValue.split("@")[1].toLowerCase();return s?L.value.filter(t=>t.substring(1).toLowerCase().startsWith(s)):A.value}else return[]}),d=c(null);M(()=>accountErrorMessage.value&&accountErrorMessage.value.length>0);const w=M(()=>u.value?!0:l.value==="phone"&&e.modelValue&&e.modelValue.length>=3),q=()=>{y.value=!0,r.value=!0,n.value=l.value==="email"&&e.modelValue.includes("@"),accountErrorMessage.value="",a.value=!0,o("validChange",!0)},x=()=>{y.value=!1,r.value=!1,setTimeout(()=>{n.value=!1},200),e.modelValue&&e.modelValue.length>=3?m():e.modelValue&&e.modelValue.length>0?(accountErrorMessage.value="账号输入错误",a.value=!1,o("validChange",!1)):(accountErrorMessage.value="",a.value=!0,o("validChange",!0))},B=()=>{l.value="",o("update:modelValue",""),a.value=!0,accountErrorMessage.value="",o("validChange",!0),o("typeChange",""),u.value=!1},D=s=>{const t=s.target.value;o("update:modelValue",t),r.value||(r.value=!0),l.value==="email"&&t.includes("@")?n.value=!0:n.value=!1,i(()=>{j(t)})},P=s=>{n.value=!1;let t=e.modelValue;t.includes("@")&&(t=t.split("@")[0]),t=t+s,o("update:modelValue",t),l.value="email",o("typeChange","email"),u.value=!1,i(()=>{m()})},j=s=>{const t=s||e.modelValue,h=window.location.search.includes("from=selectCountry");if(t.length<3){accountErrorMessage.value="",h||(u.value=!1),l.value="",o("typeChange","");return}const g=T(t);l.value!==g&&(accountErrorMessage.value=""),g==="phone"?(localStorage.getItem("nationalCode")||localStorage.setItem("nationalCode","86"),h&&(u.value=!0)):g==="email"&&(h||(u.value=!1),y.value&&(n.value=!0)),l.value=g,o("typeChange",g),t&&t.length>=3?m():(a.value=!0,o("validChange",!0),accountErrorMessage.value="")},m=()=>{if(l.value==="phone"){const s=localStorage.getItem("nationalCode")||"86";a.value=X(e.modelValue,s),a.value?(accountErrorMessage.value="",o("validChange",!0)):(accountErrorMessage.value="账号输入错误",o("validChange",!1))}else l.value==="email"&&(a.value=Y(e.modelValue),a.value?(accountErrorMessage.value="",o("validChange",!0)):(accountErrorMessage.value="请输入正确的邮箱地址",o("validChange",!1)))},z=()=>{console.log("检查是否从国家选择页面返回"),window.location.search.includes("from=selectCountry")&&sessionStorage.getItem("isFromCountrySelect")==="true"?(console.log("检测到从国家选择页面返回"),u.value=!0,e.modelValue&&e.modelValue.length>0&&(l.value="phone",o("typeChange","phone"),i(()=>{console.log("设置账号类型为phone:",l.value),m(),V()})),i(()=>{sessionStorage.removeItem("isFromCountrySelect")})):window.location.search.includes("from=selectCountry")&&(sessionStorage.removeItem("isFromCountrySelect"),F())},F=()=>{l.value==="phone"&&e.modelValue&&e.modelValue.length>=3?u.value=!0:u.value=!1};S(()=>window.location.search,s=>{console.log("URL参数变化:",s),s.includes("from=selectCountry")?sessionStorage.getItem("isFromCountrySelect")==="true"?z():F():((l.value!=="phone"||!e.modelValue||e.modelValue.length<3)&&(u.value=!1),sessionStorage.removeItem("isFromCountrySelect"))},{immediate:!0});const N=()=>{sessionStorage.setItem("isFromCountrySelect","true")},V=()=>{w.value&&d.value&&(console.log("刷新地区选择组件"),i(()=>{d.value&&typeof d.value.updateSelectedCountry=="function"&&d.value.updateSelectedCountry()}))};return S(()=>localStorage.getItem("nationalCode"),()=>{console.log("监听到国家代码变化"),l.value==="phone"&&e.modelValue&&(m(),V())},{immediate:!0}),S(()=>localStorage.getItem("selectCountry"),()=>{console.log("监听到国家选择变化"),window.location.search.includes("from=selectCountry")&&(u.value=!0,e.modelValue&&e.modelValue.length>0&&(l.value="phone",o("typeChange","phone"),m()),i(()=>{V()}))},{immediate:!0}),_({validateAccountFormat:m,accountType:l,isAccountValid:a,validate:()=>!e.modelValue||e.modelValue.length===0?(accountErrorMessage.value="请输入账号信息",a.value=!1,o("validChange",!1),!1):m(),setError:s=>{accountErrorMessage.value=s||"账号信息有误",a.value=!1,o("validChange",!1)},clearError:()=>{accountErrorMessage.value="",a.value=!0,o("validChange",!0)}}),$(()=>{if(console.log("账号输入组件已挂载"),window.location.search.includes("from=selectCountry")&&sessionStorage.getItem("isFromCountrySelect")==="true")u.value=!0,e.modelValue&&e.modelValue.length>0&&(l.value="phone",o("typeChange","phone")),i(()=>{sessionStorage.removeItem("isFromCountrySelect")});else if(e.modelValue&&e.modelValue.length>=3){const t=T(e.modelValue);t==="phone"?(l.value="phone",o("typeChange","phone"),u.value=!0):t==="email"&&(l.value="email",o("typeChange","email"),u.value=!1)}else l.value="",o("typeChange",""),u.value=!1;i(()=>{if(d.value){const t=d.value.$el;t&&(t.removeEventListener("click",N),t.addEventListener("click",N))}V()})}),(s,t)=>(f(),v("div",le,[p("label",te,C(s.$t("邮箱"))+"/"+C(s.$t("手机号码")),1),p("section",{class:H(["inputPanel",{error:e.accountError&&!r.value,borderNone:!r.value&&!e.accountError,focus:r.value}])},[O(U(ae,{from:e.from||"/login",account:e.modelValue,ref_key:"areaSelectRef",ref:d},null,8,["from","account"]),[[G,w.value]]),p("div",{class:"accountPanel",style:W({width:w.value?"265px":"345px"})},[p("input",{onFocus:q,onBlur:x,type:"text",placeholder:s.$t("请输入邮箱或手机号"),value:e.modelValue,onInput:D},null,40,ne),e.modelValue.length>0?(f(),v("span",{key:0,onClick:B})):k("",!0)],4)],2),e.accountError&&!r.value?(f(),v("div",se,C(s.$t(e.accountErrorMessage)),1)):k("",!0),l.value==="email"&&n.value?(f(),v("section",ue,[(f(!0),v(K,null,Q(R.value,(h,g)=>(f(),v("div",{key:g,onClick:ie=>P(h)},C(e.modelValue.split("@")[0]+h),9,re))),128))])):k("",!0)]))}},ve=b(ce,[["__scopeId","data-v-b914d803"]]);export{ve as a};
